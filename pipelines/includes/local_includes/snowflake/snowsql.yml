Direct SQL:
  extends:
    - .agent_tag
  stage: "Step One"
  image: $DATAOPS_UTILS_RUNNER_IMAGE
  variables:
    SNOWSQL_USERNAME: $DATAOPS_SOLE_USERNAME
    SNOWSQL_ACCOUNT: $DATAOPS_SOLE_ACCOUNT
    SNOWSQL_ROLE: $DATAOPS_SOLE_ROLE
    SNOWSQL_WAREHOUSE: $DATAOPS_SOLE_WAREHOUSE
    DATAOPS_SNOWFLAKE_AUTH: KEY_PAIR
    DATAOPS_SNOWFLAKE_KEY_PAIR: $DATAOPS_SOLE_PKEY
    DATAOPS_RUN_SQL: $CI_PROJECT_DIR/scripts/install.sql

  script:
    - /dataops
    - ls -l $CI_PROJECT_DIR/scripts
    - find $CI_PROJECT_DIR/scripts -type f | grep -v template | sort -V | while read -r file; do  echo $file && cat $file | dataops-snowsql -u $SNOWSQL_USERNAME -p "$SNOWSQL_PWD" -a $SNOWSQL_ACCOUNT -r $SNOWSQL_ROLE -w $DATAOPS_SOLE_WAREHOUSE -d $DATAOPS_DATABASE "$DATAOPS_RUN_SQL_SCRIPT" ; done
  icon: ${SNOWFLAKE_ICON}
